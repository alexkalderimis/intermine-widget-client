<!DOCTYPE html>  <html> <head>   <title>widgets.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="ChartWidget.html">                 ChartWidget.coffee               </a>                                           <a class="source" href="EnrichmentWidget.html">                 EnrichmentWidget.coffee               </a>                                           <a class="source" href="InterMineWidget.html">                 InterMineWidget.coffee               </a>                                           <a class="source" href="TableWidget.html">                 TableWidget.coffee               </a>                                           <a class="source" href="exporter.html">                 exporter.coffee               </a>                                           <a class="source" href="indexOf.html">                 indexOf.coffee               </a>                                           <a class="source" href="merge.html">                 merge.coffee               </a>                                           <a class="source" href="types.html">                 types.coffee               </a>                                           <a class="source" href="widgets.html">                 widgets.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               widgets.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h2>Interface to InterMine Widgets.</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>For our purposes, <code>$</code> means jQuery or Zepto.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">$ = </span><span class="nb">window</span><span class="p">.</span><span class="nx">jQuery</span> <span class="o">or</span> <span class="nb">window</span><span class="p">.</span><span class="nx">Zepto</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Public interface for the various InterMine Widgets.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Widgets</span>

    <span class="nv">VERSION: </span><span class="s1">&#39;1.1.10&#39;</span>

    <span class="nv">wait: </span>   <span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>JavaScript libraries as resources. Will be loaded if not present already.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">resources: </span><span class="p">[</span>
        <span class="nv">name: </span> <span class="s1">&#39;JSON&#39;</span>
        <span class="nv">path: </span> <span class="s1">&#39;http://cdnjs.cloudflare.com/ajax/libs/json3/3.2.2/json3.min.js&#39;</span>
        <span class="nv">type: </span> <span class="s1">&#39;js&#39;</span>
    <span class="p">,</span>
        <span class="nv">name: </span> <span class="s2">&quot;jQuery&quot;</span>
        <span class="nv">path: </span> <span class="s2">&quot;http://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js&quot;</span>
        <span class="nv">type: </span> <span class="s2">&quot;js&quot;</span>
        <span class="nv">wait: </span> <span class="kc">true</span>
    <span class="p">,</span>
        <span class="nv">name: </span> <span class="s2">&quot;_&quot;</span>
        <span class="nv">path: </span> <span class="s2">&quot;http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js&quot;</span>
        <span class="nv">type: </span> <span class="s2">&quot;js&quot;</span>
        <span class="nv">wait: </span> <span class="kc">true</span>
    <span class="p">,</span>
        <span class="nv">name: </span> <span class="s2">&quot;Backbone&quot;</span>
        <span class="nv">path: </span> <span class="s2">&quot;http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js&quot;</span>
        <span class="nv">type: </span> <span class="s2">&quot;js&quot;</span>
        <span class="nv">wait: </span> <span class="kc">true</span>
    <span class="p">,</span>
        <span class="nv">name: </span> <span class="s2">&quot;google&quot;</span>
        <span class="nv">path: </span> <span class="s2">&quot;https://www.google.com/jsapi&quot;</span>
        <span class="nv">type: </span> <span class="s2">&quot;js&quot;</span>
    <span class="p">,</span>
        <span class="nv">path: </span> <span class="s2">&quot;https://raw.github.com/alexkalderimis/imjs/master/src/model.js&quot;</span>
        <span class="nv">type: </span> <span class="s2">&quot;js&quot;</span>
    <span class="p">,</span>
        <span class="nv">path: </span> <span class="s2">&quot;https://raw.github.com/alexkalderimis/imjs/master/src/query.js&quot;</span>
        <span class="nv">type: </span> <span class="s2">&quot;js&quot;</span>
    <span class="p">,</span>
        <span class="nv">path: </span> <span class="s2">&quot;https://raw.github.com/alexkalderimis/imjs/master/src/service.js&quot;</span>
        <span class="nv">type: </span> <span class="s2">&quot;js&quot;</span>
    <span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>New Widgets client.</p>

<ol>
<li><code>service</code>: <a href="http://aragorn:8080/flymine/service/">http://aragorn:8080/flymine/service/</a></li>
<li><code>token</code>:   token for accessing user's lists </li>
</ol>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">constructor: </span><span class="nf">(@service, @token = &quot;&quot;) -&gt;</span>
        <span class="nx">intermine</span><span class="p">.</span><span class="nx">load</span> <span class="nx">@resources</span><span class="p">,</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>All libraries loaded, welcome jQuery, export classes.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nv">$ = </span><span class="nb">window</span><span class="p">.</span><span class="nx">jQuery</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Enable Cross-Origin Resource Sharing (for Opera, IE).
$.support.cors = true</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">o</span> <span class="k">extends</span> <span class="nx">factory</span> <span class="nb">window</span><span class="p">.</span><span class="nx">Backbone</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Switch off waiting switch.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="vi">@wait = </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Chart Widget.</p>

<ol>
<li><code>id</code>:            widgetId</li>
<li><code>bagName</code>:       myBag</li>
<li><code>el</code>:            #target</li>
<li><code>widgetOptions</code>: { "title": true/false, "description": true/false, "matchCb": function(id, type) {}, "resultsCb": function(pq) {}, "listCb": function(pq) {} }</li>
</ol>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">chart: </span><span class="p">(</span><span class="nx">opts</span><span class="p">...)</span> <span class="o">=&gt;</span>
        <span class="k">if</span> <span class="nx">@wait</span> <span class="k">then</span> <span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">((</span><span class="o">=&gt;</span> <span class="nx">@chart</span><span class="p">(</span><span class="nx">opts</span><span class="p">...)),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Load Google Visualization.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">google</span><span class="p">.</span><span class="nx">load</span> <span class="s2">&quot;visualization&quot;</span><span class="p">,</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
                <span class="nv">packages: </span><span class="p">[</span> <span class="s2">&quot;corechart&quot;</span> <span class="p">]</span>
                <span class="nv">callback: </span><span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">o</span><span class="p">.</span><span class="nx">ChartWidget</span><span class="p">(</span><span class="nx">@service</span><span class="p">,</span> <span class="nx">@token</span><span class="p">,</span> <span class="nx">opts</span><span class="p">...)</span>
    </pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Enrichment Widget.</p>

<ol>
<li><code>id</code>:            widgetId</li>
<li><code>bagName</code>:       myBag</li>
<li><code>el</code>:            #target</li>
<li><code>widgetOptions</code>: { "title": true/false, "description": true/false, "matchCb": function(id, type) {}, "resultsCb": function(pq) {}, "listCb": function(pq) {} }</li>
</ol>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">enrichment: </span><span class="p">(</span><span class="nx">opts</span><span class="p">...)</span> <span class="o">=&gt;</span>
        <span class="k">if</span> <span class="nx">@wait</span> <span class="k">then</span> <span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">((</span><span class="o">=&gt;</span> <span class="nx">@enrichment</span><span class="p">(</span><span class="nx">opts</span><span class="p">...)),</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="k">new</span> <span class="nx">o</span><span class="p">.</span><span class="nx">EnrichmentWidget</span><span class="p">(</span><span class="nx">@service</span><span class="p">,</span> <span class="nx">@token</span><span class="p">,</span> <span class="nx">opts</span><span class="p">...)</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Table Widget.</p>

<ol>
<li><code>id</code>:            widgetId</li>
<li><code>bagName</code>:       myBag</li>
<li><code>el</code>:            #target</li>
<li><code>widgetOptions</code>: { "title": true/false, "description": true/false, "matchCb": function(id, type) {}, "resultsCb": function(pq) {}, "listCb": function(pq) {} }</li>
</ol>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">table: </span><span class="p">(</span><span class="nx">opts</span><span class="p">...)</span> <span class="o">=&gt;</span>
        <span class="k">if</span> <span class="nx">@wait</span> <span class="k">then</span> <span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">((</span><span class="o">=&gt;</span> <span class="nx">@table</span><span class="p">(</span><span class="nx">opts</span><span class="p">...)),</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="k">new</span> <span class="nx">o</span><span class="p">.</span><span class="nx">TableWidget</span><span class="p">(</span><span class="nx">@service</span><span class="p">,</span> <span class="nx">@token</span><span class="p">,</span> <span class="nx">opts</span><span class="p">...)</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>All available Widgets.</p>

<ol>
<li><code>type</code>:          Gene, Protein</li>
<li><code>bagName</code>:       myBag</li>
<li><code>el</code>:            #target</li>
<li><code>widgetOptions</code>: { "title": true/false, "description": true/false, "matchCb": function(id, type) {}, "resultsCb": function(pq) {}, "listCb": function(pq) {} }</li>
</ol>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">all: </span><span class="p">(</span><span class="nv">type = </span><span class="s2">&quot;Gene&quot;</span><span class="p">,</span> <span class="nx">bagName</span><span class="p">,</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">widgetOptions</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="k">if</span> <span class="nx">@wait</span> <span class="k">then</span> <span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">((</span><span class="o">=&gt;</span> <span class="nx">@all</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">bagName</span><span class="p">,</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">widgetOptions</span><span class="p">)),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span>
                <span class="nv">url: </span>     <span class="s2">&quot;#{@service}widgets&quot;</span>
                <span class="nv">dataType: </span><span class="s2">&quot;jsonp&quot;</span>
                
                <span class="nv">success: </span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>We have results.</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="k">if</span> <span class="nx">response</span><span class="p">.</span><span class="nx">widgets</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>For all that match our object type...</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="k">for</span> <span class="nx">widget</span> <span class="k">in</span> <span class="nx">response</span><span class="p">.</span><span class="nx">widgets</span> <span class="k">when</span> <span class="nx">type</span> <span class="k">in</span> <span class="nx">widget</span><span class="p">.</span><span class="nx">targets</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Create target element for individual Widget (slugify just to make sure).</p>             </td>             <td class="code">               <div class="highlight"><pre>                            <span class="nv">widgetEl = </span><span class="nx">widget</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[^-a-zA-Z0-9,&amp;\s]+/ig</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/-/gi</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s/gi</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">()</span>
                            <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">append</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div/&gt;&#39;</span><span class="p">,</span> <span class="nv">id: </span><span class="nx">widgetEl</span><span class="p">,</span> <span class="k">class</span><span class="o">:</span> <span class="s2">&quot;widget span6&quot;</span><span class="p">)</span>
                            </pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>What type is it?</p>             </td>             <td class="code">               <div class="highlight"><pre>                            <span class="k">switch</span> <span class="nx">widget</span><span class="p">.</span><span class="nx">widgetType</span>
                                <span class="k">when</span> <span class="s2">&quot;chart&quot;</span>
                                    <span class="nx">@chart</span><span class="p">(</span><span class="nx">widget</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">bagName</span><span class="p">,</span> <span class="s2">&quot;#{el} ##{widgetEl}&quot;</span><span class="p">,</span> <span class="nx">widgetOptions</span><span class="p">)</span>
                                <span class="k">when</span> <span class="s2">&quot;enrichment&quot;</span>
                                    <span class="nx">@enrichment</span><span class="p">(</span><span class="nx">widget</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">bagName</span><span class="p">,</span> <span class="s2">&quot;#{el} ##{widgetEl}&quot;</span><span class="p">,</span> <span class="nx">widgetOptions</span><span class="p">)</span>
                                <span class="k">when</span> <span class="s2">&quot;table&quot;</span>
                                    <span class="nx">@table</span><span class="p">(</span><span class="nx">widget</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">bagName</span><span class="p">,</span> <span class="s2">&quot;#{el} ##{widgetEl}&quot;</span><span class="p">,</span> <span class="nx">widgetOptions</span><span class="p">)</span>
                
                <span class="nv">error: </span><span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">opts</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">html</span> <span class="nx">$</span> <span class="s1">&#39;&lt;div/&gt;&#39;</span><span class="p">,</span>
                    <span class="k">class</span><span class="o">:</span> <span class="s2">&quot;alert alert-error&quot;</span>
                    <span class="nv">html: </span> <span class="s2">&quot;#{xhr.statusText} for &lt;a href=&#39;#{@service}widgets&#39;&gt;#{@service}widgets&lt;/a&gt;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Do we have the InterMine API Loader?</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">if</span> <span class="o">not</span> <span class="nb">window</span><span class="p">.</span><span class="nx">intermine</span>
    <span class="k">throw</span> <span class="s1">&#39;You need to include the InterMine API Loader first!&#39;</span>
<span class="k">else</span>
    <span class="nb">window</span><span class="p">.</span><span class="nv">intermine.widgets = </span><span class="nx">Widgets</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 