(function(){var a={},b={};b["error.eco"]=function(a){a||(a={});var b=[],c=function(a){var c=b,d;return b=[],a.call(this),d=b.join(""),b=c,e(d)},d=function(a){return a&&a.ecoSafe?a:typeof a!="undefined"&&a!=null?g(a):""},e,f=a.safe,g=a.escape;return e=a.safe=function(a){if(a&&a.ecoSafe)return a;if(typeof a=="undefined"||a==null)a="";var b=new String(a);return b.ecoSafe=!0,b},g||(g=a.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){b.push('<div class="alert alert-block">\n    <h4 class="alert-heading">'),b.push(d(this.title)),b.push(" for "),b.push(d(this.name)),b.push("</h4>\n    <p>"),b.push(this.text),b.push("</p>\n</div>")}).call(this)}.call(a),a.safe=f,a.escape=g,b.join("")},b["actions.eco"]=function(a){a||(a={});var b=[],c=function(a){var c=b,d;return b=[],a.call(this),d=b.join(""),b=c,e(d)},d=function(a){return a&&a.ecoSafe?a:typeof a!="undefined"&&a!=null?g(a):""},e,f=a.safe,g=a.escape;return e=a.safe=function(a){if(a&&a.ecoSafe)return a;if(typeof a=="undefined"||a==null)a="";var b=new String(a);return b.ecoSafe=!0,b},g||(g=a.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){b.push('<a class="btn btn-small '),this.disabled&&b.push("disabled"),b.push(' view">View</a>\n<a class="btn btn-small '),this.disabled&&b.push("disabled"),b.push(' export">Download</a>')}).call(this)}.call(a),a.safe=f,a.escape=g,b.join("")},b["extra.eco"]=function(a){a||(a={});var b=[],c=function(a){var c=b,d;return b=[],a.call(this),d=b.join(""),b=c,e(d)},d=function(a){return a&&a.ecoSafe?a:typeof a!="undefined"&&a!=null?g(a):""},e,f=a.safe,g=a.escape;return e=a.safe=function(a){if(a&&a.ecoSafe)return a;if(typeof a=="undefined"||a==null)a="";var b=new String(a);return b.ecoSafe=!0,b},g||(g=a.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){var a,c,e,f;b.push('<div class="group" style="display:inline-block;margin-right:5px;float:left">\n    <label>'),b.push(d(this.label)),b.push("</label>\n    ");if(this.possible.length>1){b.push('\n        <select name="'),b.push(d(this.label)),b.push('" class="span2">\n            '),f=this.possible;for(c=0,e=f.length;c<e;c++)a=f[c],b.push('\n                <option value="'),b.push(d(a)),b.push('" '),this.selected===a&&b.push(d('selected="selected"')),b.push(">\n                    "),b.push(d(a)),b.push("\n                </option>\n            ");b.push("\n        </select>\n    ")}else b.push("\n        "),b.push(d(this.possible[0])),b.push("\n    ");b.push("\n</div>")}).call(this)}.call(a),a.safe=f,a.escape=g,b.join("")},b["noresults.eco"]=function(a){a||(a={});var b=[],c=function(a){var c=b,d;return b=[],a.call(this),d=b.join(""),b=c,e(d)},d=function(a){return a&&a.ecoSafe?a:typeof a!="undefined"&&a!=null?g(a):""},e,f=a.safe,g=a.escape;return e=a.safe=function(a){if(a&&a.ecoSafe)return a;if(typeof a=="undefined"||a==null)a="";var b=new String(a);return b.ecoSafe=!0,b},g||(g=a.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){b.push('<div class="alert alert-info">\n    <p>The Widget has no results.</p>\n</div>')}).call(this)}.call(a),a.safe=f,a.escape=g,b.join("")},b["loading.eco"]=function(a){a||(a={});var b=[],c=function(a){var c=b,d;return b=[],a.call(this),d=b.join(""),b=c,e(d)},d=function(a){return a&&a.ecoSafe?a:typeof a!="undefined"&&a!=null?g(a):""},e,f=a.safe,g=a.escape;return e=a.safe=function(a){if(a&&a.ecoSafe)return a;if(typeof a=="undefined"||a==null)a="";var b=new String(a);return b.ecoSafe=!0,b},g||(g=a.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){b.push('<div class="loading" style="background:rgba(255,255,255,0.9);position:absolute;top:0;left:0;height:100%;width:100%;text-align:center;">\n    <p style="padding-top:50%;font-weight:bold;">Loading &hellip;</p>\n</div>')}).call(this)}.call(a),a.safe=f,a.escape=g,b.join("")},b["invalidjsonkey.eco"]=function(a){a||(a={});var b=[],c=function(a){var c=b,d;return b=[],a.call(this),d=b.join(""),b=c,e(d)},d=function(a){return a&&a.ecoSafe?a:typeof a!="undefined"&&a!=null?g(a):""},e,f=a.safe,g=a.escape;return e=a.safe=function(a){if(a&&a.ecoSafe)return a;if(typeof a=="undefined"||a==null)a="";var b=new String(a);return b.ecoSafe=!0,b},g||(g=a.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){b.push('<li style="vertical-align:bottom">\n    <span style="display:inline-block" class="label label-important">'),b.push(d(this.key)),b.push("</span> is "),b.push(d(this.actual)),b.push("; was expecting "),b.push(d(this.expected)),b.push("\n</li>")}).call(this)}.call(a),a.safe=f,a.escape=g,b.join("")},b["popover.values.eco"]=function(a){a||(a={});var b=[],c=function(a){var c=b,d;return b=[],a.call(this),d=b.join(""),b=c,e(d)},d=function(a){return a&&a.ecoSafe?a:typeof a!="undefined"&&a!=null?g(a):""},e,f=a.safe,g=a.escape;return e=a.safe=function(a){if(a&&a.ecoSafe)return a;if(typeof a=="undefined"||a==null)a="";var b=new String(a);return b.ecoSafe=!0,b},g||(g=a.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){var a,c,e,f;b.push("<h4>"),b.push(d(this.values.length)),b.push(" "),b.push(d(this.type)),this.values.length!==1&&b.push(d("s")),b.push(":</h4>\n\n"),f=this.values.slice(0,this.valuesLimit-1+1||9e9);for(c=0,e=f.length;c<e;c++)a=f[c],b.push('\n    <a href="#" class="match">'),b.push(d(a)),b.push("</a>\n");b.push("\n"),this.values.length>this.valuesLimit&&b.push("&hellip;")}).call(this)}.call(a),a.safe=f,a.escape=g,b.join("")},b["popover.eco"]=function(a){a||(a={});var b=[],c=function(a){var c=b,d;return b=[],a.call(this),d=b.join(""),b=c,e(d)},d=function(a){return a&&a.ecoSafe?a:typeof a!="undefined"&&a!=null?g(a):""},e,f=a.safe,g=a.escape;return e=a.safe=function(a){if(a&&a.ecoSafe)return a;if(typeof a=="undefined"||a==null)a="";var b=new String(a);return b.ecoSafe=!0,b},g||(g=a.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){b.push('<div class="popover" style="position:absolute;top:5px;right:0;z-index:1;display:block">\n    <div class="popover-inner" style="'),b.push(d(this.style)),b.push('">\n        <a style="cursor:pointer;margin:2px 5px 0 0" class="close">Ã—</a>\n        <h3 class="popover-title">\n            '),b.push(d(this.description.slice(0,this.descriptionLimit-1+1||9e9))),b.push("\n            "),this.description.length>this.descriptionLimit&&b.push("&hellip;"),b.push('\n        </h3>\n        <div class="popover-content">\n            <div class="values">\n                <!-- popover.values.eco -->\n            </div>\n            <div style="margin-top:10px">\n                <a class="btn btn-small btn-primary results">View results</a>\n                <a class="btn btn-small list disabled">Create list</a>\n            </div>\n        </div>\n    </div>\n</div>')}).call(this)}.call(a),a.safe=f,a.escape=g,b.join("")},b["chart.eco"]=function(a){a||(a={});var b=[],c=function(a){var c=b,d;return b=[],a.call(this),d=b.join(""),b=c,e(d)},d=function(a){return a&&a.ecoSafe?a:typeof a!="undefined"&&a!=null?g(a):""},e,f=a.safe,g=a.escape;return e=a.safe=function(a){if(a&&a.ecoSafe)return a;if(typeof a=="undefined"||a==null)a="";var b=new String(a);return b.ecoSafe=!0,b},g||(g=a.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){b.push('<div class="header">\n    <h3>'),this.title&&b.push(d(this.title)),b.push('</h3>\n    <p style="margin:0">'),this.description&&b.push(this.description),b.push("</p>\n    "),this.notAnalysed&&(b.push('\n        <p style="margin:10px 0 0 0">Number of Genes in this list not analysed in this widget: <a>'),b.push(d(this.notAnalysed)),b.push("</a></p>\n    ")),b.push('\n\n    <div class="form">\n        <form style="margin:0;padding:10px 0 0 0">\n            <!-- extra.eco -->\n        </form>\n    </div>\n</div>\n<div class="content">\n    <div class="settings"></div>\n    <div class="legend"></div>\n    <div class="chart"></div>\n</div>')}).call(this)}.call(a),a.safe=f,a.escape=g,b.join("")},b["enrichment.row.eco"]=function(a){a||(a={});var b=[],c=function(a){var c=b,d;return b=[],a.call(this),d=b.join(""),b=c,e(d)},d=function(a){return a&&a.ecoSafe?a:typeof a!="undefined"&&a!=null?g(a):""},e,f=a.safe,g=a.escape;return e=a.safe=function(a){if(a&&a.ecoSafe)return a;if(typeof a=="undefined"||a==null)a="";var b=new String(a);return b.ecoSafe=!0,b},g||(g=a.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){b.push('<td class="check"><input type="checkbox" '),this.row.selected&&b.push('checked="checked"'),b.push(' /></td>\n<td class="description">\n    '),b.push(d(this.row.description)),b.push("\n    "),this.row.externalLink&&(b.push('\n        [<a href="'),b.push(this.row.externalLink),b.push('" target="_blank">Link</a>]\n    ')),b.push('\n</td>\n<td class="pValue">'),b.push(d(this.row["p-value"].toPrecision(5))),b.push('</td>\n<td class="matches">\n    <a class="count" style="cursor:pointer">'),b.push(d(this.row.matches)),b.push("</a>\n</td>")}).call(this)}.call(a),a.safe=f,a.escape=g,b.join("")},b["enrichment.eco"]=function(a){a||(a={});var b=[],c=function(a){var c=b,d;return b=[],a.call(this),d=b.join(""),b=c,e(d)},d=function(a){return a&&a.ecoSafe?a:typeof a!="undefined"&&a!=null?g(a):""},e,f=a.safe,g=a.escape;return e=a.safe=function(a){if(a&&a.ecoSafe)return a;if(typeof a=="undefined"||a==null)a="";var b=new String(a);return b.ecoSafe=!0,b},g||(g=a.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){b.push('<div class="header">\n    <h3>'),this.title&&b.push(d(this.title)),b.push("</h3>\n    <p>"),this.description&&b.push(this.description),b.push("</p>\n    "),this.notAnalysed&&(b.push("\n        <p>Number of Genes in this list not analysed in this widget: <a>"),b.push(d(this.notAnalysed)),b.push("</a></p>\n    ")),b.push('\n\n    <div class="form">\n        <!-- enrichment.form.eco -->\n    </div>\n\n    <div class="actions" style="padding:10px 0">\n        <!-- actions.eco -->\n    </div>\n</div>\n<div class="content">\n    <!-- enrichment.table.eco -->\n</div>')}).call(this)}.call(a),a.safe=f,a.escape=g,b.join("")},b["enrichment.table.eco"]=function(a){a||(a={});var b=[],c=function(a){var c=b,d;return b=[],a.call(this),d=b.join(""),b=c,e(d)},d=function(a){return a&&a.ecoSafe?a:typeof a!="undefined"&&a!=null?g(a):""},e,f=a.safe,g=a.escape;return e=a.safe=function(a){if(a&&a.ecoSafe)return a;if(typeof a=="undefined"||a==null)a="";var b=new String(a);return b.ecoSafe=!0,b},g||(g=a.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){b.push('<!-- actual fixed head -->\n<div class="head" style="display:table">\n    <div style="font-weight:bold;display:table-cell;padding:0 8px;"><input type="checkbox" class="check" /></div>\n    <div style="font-weight:bold;display:table-cell;padding:0 8px;">'),b.push(d(this.label)),b.push('</div>\n    <div style="font-weight:bold;display:table-cell;padding:0 8px;">p-Value</div>\n    <div style="font-weight:bold;display:table-cell;padding:0 8px;">Matches</div>\n    <div style="clear:both"></div>\n</div>\n<div class="wrapper" style="overflow:auto;overflow-x:hidden">\n    <table class="table table-striped">\n        <!-- head for proper cell width -->\n        <thead style="visibility:hidden">\n            <tr>\n                <th></th>\n                <th>'),b.push(d(this.label)),b.push("</th>\n                <th>p-Value</th>\n                <th>Matches</th>\n            </tr>\n        </thead>\n        <tbody>\n            <!-- loop enrichment.row.eco -->\n        </tbody>\n    </table>\n</div>")}).call(this)}.call(a),a.safe=f,a.escape=g,b.join("")},b["enrichment.form.eco"]=function(a){a||(a={});var b=[],c=function(a){var c=b,d;return b=[],a.call(this),d=b.join(""),b=c,e(d)},d=function(a){return a&&a.ecoSafe?a:typeof a!="undefined"&&a!=null?g(a):""},e,f=a.safe,g=a.escape;return e=a.safe=function(a){if(a&&a.ecoSafe)return a;if(typeof a=="undefined"||a==null)a="";var b=new String(a);return b.ecoSafe=!0,b},g||(g=a.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){var a,c,e,f,g,h,i,j;b.push('<form style="margin:0">\n    <div class="group" style="display:inline-block;margin-right:5px;float:left">\n        <label>Test Correction</label>\n        <select name="errorCorrection" class="span2">\n            '),i=this.errorCorrections;for(e=0,g=i.length;e<g;e++)a=i[e],b.push('\n                <option value="'),b.push(d(a)),b.push('" '),this.options.errorCorrection===a&&b.push(d('selected="selected"')),b.push(">\n                    "),b.push(d(a)),b.push("\n            </option>\n            ");b.push('\n        </select>\n    </div>\n\n    <div class="group" style="display:inline-block;margin-right:5px;float:left">\n        <label>Max p-value</label>\n        <select name="pValue" class="span2">\n            '),j=this.pValues;for(f=0,h=j.length;f<h;f++)c=j[f],b.push('\n                <option value="'),b.push(d(c)),b.push('" '),this.options.pValue===c&&b.push(d('selected="selected"')),b.push(">\n                    "),b.push(d(c)),b.push("\n                </option>\n            ");b.push('\n        </select>\n    </div>\n</form>\n<div style="clear:both"></div>')}).call(this)}.call(a),a.safe=f,a.escape=g,b.join("")},b["table.row.eco"]=function(a){a||(a={});var b=[],c=function(a){var c=b,d;return b=[],a.call(this),d=b.join(""),b=c,e(d)},d=function(a){return a&&a.ecoSafe?a:typeof a!="undefined"&&a!=null?g(a):""},e,f=a.safe,g=a.escape;return e=a.safe=function(a){if(a&&a.ecoSafe)return a;if(typeof a=="undefined"||a==null)a="";var b=new String(a);return b.ecoSafe=!0,b},g||(g=a.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){var a,c,e,f;b.push('<td class="check"><input type="checkbox" '),this.row.selected&&b.push('checked="checked"'),b.push(" /></td>\n"),f=this.row.descriptions;for(c=0,e=f.length;c<e;c++)a=f[c],b.push("\n    <td>"),b.push(d(a)),b.push("</td>\n");b.push("\n<td>"),b.push(d(this.row.matches)),b.push("</td>")}).call(this)}.call(a),a.safe=f,a.escape=g,b.join("")},b["table.eco"]=function(a){a||(a={});var b=[],c=function(a){var c=b,d;return b=[],a.call(this),d=b.join(""),b=c,e(d)},d=function(a){return a&&a.ecoSafe?a:typeof a!="undefined"&&a!=null?g(a):""},e,f=a.safe,g=a.escape;return e=a.safe=function(a){if(a&&a.ecoSafe)return a;if(typeof a=="undefined"||a==null)a="";var b=new String(a);return b.ecoSafe=!0,b},g||(g=a.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){b.push('<div class="header">\n    <h3>'),this.title&&b.push(d(this.title)),b.push("</h3>\n    <p>"),this.description&&b.push(this.description),b.push("</p>\n    "),this.notAnalysed&&(b.push("\n        <p>Number of Genes in this list not analysed in this widget: <a>"),b.push(d(this.notAnalysed)),b.push("</a></p>\n    ")),b.push('\n\n    <div class="actions" style="padding:10px 0">\n        <!-- actions.eco -->\n    </div>\n</div>\n<div class="content">\n    <!-- table.table.eco -->\n</div>')}).call(this)}.call(a),a.safe=f,a.escape=g,b.join("")},b["table.table.eco"]=function(a){a||(a={});var b=[],c=function(a){var c=b,d;return b=[],a.call(this),d=b.join(""),b=c,e(d)},d=function(a){return a&&a.ecoSafe?a:typeof a!="undefined"&&a!=null?g(a):""},e,f=a.safe,g=a.escape;return e=a.safe=function(a){if(a&&a.ecoSafe)return a;if(typeof a=="undefined"||a==null)a="";var b=new String(a);return b.ecoSafe=!0,b},g||(g=a.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){var a,c,e,f,g,h,i;b.push('<!-- actual fixed head -->\n<div class="head" style="display:table">\n    <div style="font-weight:bold;display:table-cell;padding:0 8px;"><input type="checkbox" class="check" /></div>\n    '),h=this.columns;for(c=0,f=h.length;c<f;c++)a=h[c],b.push('\n        <div style="font-weight:bold;display:table-cell;padding:0 8px;">'),b.push(d(a)),b.push("</div>\n    ");b.push('\n    <div style="clear:both"></div>\n</div>\n<div class="wrapper" style="overflow:auto;overflow-x:hidden">\n    <table class="table table-striped">\n        <!-- head for proper cell width -->\n        <thead style="visibility:hidden">\n            <tr>\n                <th></th>\n                '),i=this.columns;for(e=0,g=i.length;e<g;e++)a=i[e],b.push("\n                    <th>"),b.push(d(a)),b.push("</th>\n                ");b.push("\n            </tr>\n        </thead>\n        <tbody>\n            <!-- loop table.row.eco -->\n        </tbody>\n    </table>\n</div>")}).call(this)}.call(a),a.safe=f,a.escape=g,b.join("")};var c,d={}.hasOwnProperty,e=function(a,b){function e(){this.constructor=a}for(var c in b)d.call(b,c)&&(a[c]=b[c]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a};c={},c.Root=function(){function a(){}return a.name="Root",a.prototype.result=!1,a.prototype.is=function(){return this.result},a.prototype.toString=function(){return""+this.expected+" but got "+this.actual},a}(),c.isString=function(a){function b(a){this.actual=a,this.result=typeof a=="string"}return e(b,a),b.name="isString",b.prototype.expected="String",b}(c.Root),c.isInteger=function(a){function b(a){this.actual=a,this.result=typeof a=="number"}return e(b,a),b.name="isInteger",b.prototype.expected="Integer",b}(c.Root),c.isBoolean=function(a){function b(a){this.actual=a,this.result=typeof a=="boolean"}return e(b,a),b.name="isBoolean",b.prototype.expected="Boolean true",b}(c.Root),c.isNull=function(a){function b(a){this.actual=a,this.result=a===null}return e(b,a),b.name="isNull",b.prototype.expected="Null",b}(c.Root),c.isArray=function(a){function b(a){this.actual=a,this.result=a instanceof Array}return e(b,a),b.name="isArray",b.prototype.expected="Array",b}(c.Root),c.isHTTPSuccess=function(a){function b(a){this.actual=a,this.result=a===200}return e(b,a),b.name="isHTTPSuccess",b.prototype.expected="HTTP code 200",b}(c.Root),c.isJSON=function(a){function b(a){this.actual=a,this.result=!0;try{typeof JSON!="undefined"&&JSON!==null&&JSON.parse(a)}catch(b){this.result=!1}}return e(b,a),b.name="isJSON",b.prototype.expected="JSON Object",b}(c.Root),c.isUndefined=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return e(b,a),b.name="isUndefined",b.prototype.expected="it to be undefined",b}(c.Root);var f;f=function(a,b){var c;for(c in b)a[c]==null&&Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c]);return a};var g;g={expliticize:function(a){var b,c,d,e,f;switch(a.node().nodeName){case"rect":b=["fill","stroke"];break;case"text":b=["fill","font-family","font-size"];break;case"line":b=["stroke"]}f=[];for(d=0,e=b.length;d<e;d++)c=b[d],f.push(a.attr(c,window.getComputedStyle(a.node(),null).getPropertyValue(c)));return f},toPNG:function(a,b,c){var d;return d=l("<canvas/>",{style:"image-rendering:-moz-crisp-edges;image-rendering:-webkit-optimize-contrast"}).attr("width",b).attr("height",c),canvg(d[0],l(a).html()),d[0].toDataURL("image/png")}},g.Column=function(){function a(a){var b,c;for(b in a)c=a[b],this[b]=c;l(this.el).css("height",this.height)}return a.name="Column",a.prototype.isStacked=!1,a.prototype.colorbrewer=4,a.prototype.padding={barValue:2,axisLabels:5,barPadding:.05},a.prototype.ticks={count:10},a.prototype.description={triangle:{degrees:30,sideA:.5,sideB:.866025}},a.prototype.series={},a.prototype.render=function(){var a,b,c,d,e,f,h,i,j,k,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,ab,bb,cb=this;t=this.height,I=this.width,l(this.el).empty(),f=d3.select(this.el[0]).append("svg:svg").attr("class","canvas"),this.useWholeNumbers=!0,this.maxValue=-Infinity;if(this.isStacked){Q=this.data;for(L=0,O=Q.length;L<O;L++){r=Q[L],s=0,R=r.data;for(v in R)E=R[v],parseInt(E)!==E&&(this.useWholeNumbers=!1),s+=E;s>this.maxValue&&(this.maxValue=s)}}else{U=this.data;for(M=0,P=U.length;M<P;M++){r=U[M],V=r.data;for(v in V)E=V[v],parseInt(E)!==E&&(this.useWholeNumbers=!1),E>this.maxValue&&(this.maxValue=E)}}this.axis!=null&&(w=f.append("svg:g").attr("class","labels"),this.axis.horizontal!=null&&(A=w.append("svg:text").attr("class","horizontal").attr("text-anchor","middle").attr("x",I/2).attr("y",t-this.padding.axisLabels).text(this.axis.horizontal),t=t-A.node().getBBox().height-this.padding.axisLabels,g.expliticize(A)),this.axis.vertical!=null&&(A=w.append("svg:text").attr("class","vertical").attr("text-anchor","middle").attr("x",0).attr("y",t/2).text(this.axis.vertical),G=A.node().getBBox().height,A.attr("transform","rotate(-90 "+G+" "+t/2+")"),I=I-G-this.padding.axisLabels,g.expliticize(A))),n=f.append("svg:g").attr("class","descriptions"),this.description.maxWidth=-Infinity,this.description.totalWidth=0,m=0,W=this.data;for(u in W)r=W[u],p=n.append("svg:g").attr("class","g"+u),A=p.append("svg:text").attr("class","text").attr("text-anchor","end").text(r.description),B=A.node().getComputedTextLength(),B>this.description.maxWidth&&(this.description.maxWidth=B),this.description.totalWidth=this.description.totalWidth+B,g.expliticize(A),p.append("svg:title").text(r.description),m===0&&(m=A.node().getBBox().height);t-=m,q=f.append("svg:g").attr("class","grid"),o={},o.ticks=function(){var a,b,c,d,e;d=d3.scale.linear().domain([0,cb.maxValue]).ticks(cb.ticks.count),e=[];for(b=0,c=d.length;b<c;b++)a=d[b],(parseInt(a)===a||!cb.useWholeNumbers)&&e.push(a);return e}(),this.ticks.maxWidth=-Infinity,X=o.ticks;for(u in X)C=X[u],z=q.append("svg:g").attr("class","t"+u),A=z.append("svg:text").attr("class","tick").attr("text-anchor","begin").attr("x",0).text(C),B=A.node().getComputedTextLength(),B>this.ticks.maxWidth&&(this.ticks.maxWidth=B),g.expliticize(A);I-=this.ticks.maxWidth,this.description.totalWidth>I&&(t-=this.description.maxWidth*this.description.triangle.sideA),((Y=this.axis)!=null?Y.vertical:void 0)!=null&&w.select(".vertical").attr("transform","rotate(-90 "+G+" "+t/2+")").attr("y",t/2),o.x=d3.scale.ordinal().domain(function(){bb=[];for(var a=0,b=this.data.length-1;0<=b?a<=b:a>=b;0<=b?a++:a--)bb.push(a);return bb}.apply(this)).rangeBands([0,I],this.padding.barPadding),o.y=d3.scale.linear().domain([0,this.maxValue]).range([0,t]),o.color=d3.scale.linear().domain([0,this.maxValue]).rangeRound([0,this.colorbrewer-1]),_=o.ticks;for(u in _)C=_[u],z=q.select(".t"+u),x=z.append("svg:line").attr("class","line").attr("x1",this.ticks.maxWidth).attr("x2",I+this.ticks.maxWidth),g.expliticize(x),z.attr("transform","translate(0,"+(t-o.y(C))+")");h=f.append("svg:g").attr("class","chart"),e=h.append("svg:g").attr("class","bars"),F=h.append("svg:g").attr("class","values"),ab=this.data;for(u in ab){r=ab[u],p=e.append("svg:g").attr("class","g"+u),d=o.x.rangeBand(),this.isStacked||(d/=r.data.length),!this.isStacked&&r.data.length===2&&function(){var a;return a=cb.ticks.maxWidth+o.x(u)+d,x=p.append("svg:line").attr("class","line dashed").attr("style","stroke-dasharray: 10, 5;").attr("x1",a).attr("x2",a).attr("y1",0).attr("y2",t)}(),K=t,S=r.data;for(y in S){E=S[y],b=o.y(E);if(!b&&this.isStacked)continue;J=o.x(u)+this.ticks.maxWidth,this.isStacked||(J+=y*d),this.isStacked||(K=t),K-=b,i=o.color(E).toFixed(0),a=p.append("svg:rect").attr("class","bar s"+y+" q"+i+"-"+this.colorbrewer).attr("x",J).attr("y",K).attr("width",d).attr("height",b),a.transition().attr("opacity",1),g.expliticize(a),H=F.append("svg:g").attr("class","g"+u+" s"+y+" q"+i+"-"+this.colorbrewer),A=H.append("svg:text").attr("x",J+d/2).attr("text-anchor","middle").text(E),this.isStacked?(D=K+A.node().getBBox().height+this.padding.barValue,A.attr("y",D),A.node().getComputedTextLength()>d?A.attr("class","value on beyond"):A.attr("class","value on")):(D=K-this.padding.barValue,c=A.node().getBBox().height,D<c?(A.attr("y",D+c),A.node().getComputedTextLength()>d?A.attr("class","value on beyond"):A.attr("class","value on")):(A.attr("y",D),A.attr("class","value above"))),g.expliticize(A),H.append("svg:title").text(E),this.onclick!=null&&function(a,b,c,d){return a.on("click",function(){return cb.onclick(b.description,c,d)})}(a,r,y,E)}p.append("svg:title").text(r.description),k=n.select(".g"+u),j=k.select("text");if(this.description.maxWidth>d){j.attr("transform","rotate(-"+this.description.triangle.degrees+" 0 0)"),J+=d;while(j.node().getComputedTextLength()*this.description.triangle.sideB>J)j.text(j.text().replace("...","").split("").reverse().slice(1).reverse().join("")+"...")}else J=J+d-.5*d*r.data.length,j.attr("text-anchor","middle");k.attr("transform","translate("+J+","+(t+m)+")")}if(((T=this.axis)!=null?T.vertical:void 0)!=null)return q.attr("transform","translate("+(G+this.padding.axisLabels)+", 0)"),h.attr("transform","translate("+(G+this.padding.axisLabels)+", 0)"),n.attr("transform","translate("+(G+this.padding.axisLabels)+", 0)")},a.prototype.hideSeries=function(a){return d3.select(this.el[0]).selectAll(".s"+a).transition().attr("fill-opacity",.1)},a.prototype.showSeries=function(a){return d3.select(this.el[0]).selectAll(".s"+a).transition().attr("fill-opacity",1)},a.prototype.toPNG=function(){return g.toPNG(this.el,this.width,this.height)},a}(),g.Legend=function(){function a(a){var b,c;for(b in a)c=a[b],this[b]=c}return a.name="Legend",a.prototype.render=function(){var a,b,c,d,e,f=this;l(this.el).empty(),l(this.el).append(c=l("<ul/>")),d=this.series,e=[];for(a in d)b=d[a],e.push(function(a,b){return c.append(l("<li/>",{"class":"s"+a,html:b,click:function(b){return f.clickAction(b.target,a)}}))}(a,b));return e},a.prototype.clickAction=function(a,b){return l(a).toggleClass("disabled"),l(a).hasClass("disabled")?this.chart.hideSeries(b):this.chart.showSeries(b)},a}(),g.Settings=function(){function a(a){var b,c;for(b in a)c=a[b],this[b]=c}return a.name="Settings",a.prototype.render=function(){var a,b=this;return l(this.el).empty(),a=l(this.el).append(l("<a/>",{"class":"btn btn-mini stacked "+(this.isStacked?"active":""),text:this.isStacked?"Unstack":"Stack",click:function(a){return l(a.target).toggleClass("active"),l(a.target).hasClass("active")?(b.chart.isStacked=!0,l(a.target).text("Unstack")):(b.chart.isStacked=!1,l(a.target).text("Stack")),b.legend.render(),b.chart.render()}})),l(this.el).append(l("<a/>",{"class":"btn btn-mini png",text:"Save as a PNG",click:function(a){return i(a.target,'<img src="'+b.chart.toPNG()+'"/>')}}))},a}(),"bind"in Function.prototype||(Function.prototype.bind=function(a){var b,c;return c=this,arguments.length<=1?function(){return c.apply(a,arguments)}:(b=Array.prototype.slice.call(arguments,1),function(){return c.apply(a,arguments.length===0?b:b.concat(Array.prototype.slice.call(arguments)))})}),"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),"indexOf"in Array.prototype||(Array.prototype.indexOf=function(a,b){var c;b===undefined&&(b=0),b<0&&(b+=this.length),b<0&&(b=0),c=this.length;while(b<c){if(b in this&&this[b]===a)return b;b++}return-1}),"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(a,b){b===undefined&&(b=this.length-1),b<0&&(b+=this.length),b>this.length-1&&(b=this.length-1),b++;while(b-->0)if(b in this&&this[b]===a)return b;return-1}),"forEach"in Array.prototype||(Array.prototype.forEach=function(a,b){var c,d,e;c=0,d=this.length,e=[];while(c<d)c in this&&a.call(b,this[c],c,this),e.push(c++);return e}),"map"in Array.prototype||(Array.prototype.map=function(a,b){var c,d,e;e=new Array(this.length),c=0,d=this.length;while(c<d)c in this&&(e[c]=a.call(b,this[c],c,this)),c++;return e}),"filter"in Array.prototype||(Array.prototype.filter=function(a,b){var c,d,e,f;e=[],f=void 0,c=0,d=this.length;while(c<d)c in this&&a.call(b,f=this[c],c,this)&&e.push(f),c++;return e}),"every"in Array.prototype||(Array.prototype.every=function(a,b){var c,d;c=0,d=this.length;while(c<d){if(c in this&&!a.call(b,this[c],c,this))return!1;c++}return!0}),"some"in Array.prototype||(Array.prototype.some=function(a,b){var c,d;c=0,d=this.length;while(c<d){if(c in this&&a.call(b,this[c],c,this))return!0;c++}return!1});var h,i,j=function(a,b){return function(){return a.apply(b,arguments)}};h=function(){function a(a,b,c){var d;c==null&&(c="widget.tsv"),this.destroy=j(this.destroy,this),d=new(window.WebKitBlobBuilder||window.MozBlobBuilder||window.BlobBuilder),d.append(b),a.attr("download",c),(this.href=this.url.createObjectURL(d.getBlob(""+this.mime+";charset="+this.charset)))&&a.attr("href",this.href),a.attr("data-downloadurl",[this.mime,c,this.href].join(":"))}return a.name="Exporter",a.prototype.mime="text/plain",a.prototype.charset="UTF-8",a.prototype.url=window.webkitURL||window.URL,a.prototype.destroy=function(){return this.url.revokeObjectURL(this.href)},a}(),i=function(){function a(a,b){var c;c=window.open(),c==null||typeof c=="undefined"?a.after(this.msg=l("<span/>",{style:"margin-left:5px","class":"label label-inverse",text:"Please enable popups"})):(c.document.open(),c.document.write(b),c.document.close())}return a.name="PlainExporter",a.prototype.destroy=function(){var a;return(a=this.msg)!=null?a.fadeOut():void 0},a}();var k;k=function(a){var d,e=function(a,b){return function(){return a.apply(b,arguments)}};d=function(){function a(){this.error=e(this.error,this),this.validateType=e(this.validateType,this),l(this.el).html(l("<div/>",{"class":"inner",style:"height:572px;overflow:hidden;position:relative"})),this.el=""+this.el+" div.inner",this.imService=new intermine.Service({root:this.service,token:this.token})}return a.name="InterMineWidget",a.prototype.template=function(a,c){var d;return c==null&&(c={}),typeof b[d=""+a+".eco"]=="function"?b[d](c):void 0},a.prototype.validateType=function(a,b){var d,e,f,g;d=[];for(e in a)g=a[e],(f=(typeof b[e]=="function"?new b[e](g):void 0)||(f=new c.isUndefined))&&!f.is()&&d.push(this.template("invalidjsonkey",{key:e,actual:f.is(),expected:new String(f)}));if(d.length)return this.error(d,"JSONResponse")},a.prototype.error=function(a,b){a==null&&(a={title:"Error",text:"Generic error"}),a.name=this.name||this.id;switch(b){case"AJAXTransport":a.title=a.statusText,a.text=a.responseText;break;case"JSONResponse":a.title="Invalid JSON Response",a.text="<ol>"+a.join("")+"</ol>"}throw l(this.el).html(this.template("error",a)),new Error(b)},a}();var h,e=function(a,b){return function(){return a.apply(b,arguments)}},j={}.hasOwnProperty,k=function(a,b){function d(){this.constructor=a}for(var c in b)j.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};h=function(a){function b(a,c,d,g,h,i){this.service=a,this.token=c,this.id=d,this.bagName=g,this.el=h,i==null&&(i={}),this.render=e(this.render,this),this.widgetOptions=f(i,this.widgetOptions),b.__super__.constructor.call(this),this.render()}return k(b,a),b.name="ChartWidget",b.prototype.widgetOptions={title:!0,description:!0,matchCb:function(a,b){return typeof console!="undefined"&&console!==null?console.log(a,b):void 0},resultsCb:function(a){return typeof console!="undefined"&&console!==null?console.log(a):void 0},listCb:function(a){return typeof console!="undefined"&&console!==null?console.log(a):void 0}},b.prototype.formOptions={},b.prototype.spec={response:{chartType:c.isString,description:c.isString,error:c.isNull,list:c.isString,notAnalysed:c.isInteger,pathQuery:c.isString,requestedAt:c.isString,results:c.isArray,seriesLabels:c.isString,seriesValues:c.isString,statusCode:c.isHTTPSuccess,title:c.isString,type:c.isString,wasSuccessful:c.isBoolean,filters:c.isString,filterLabel:c.isString,filterSelectedValue:c.isString,simplePathQuery:c.isString,domainLabel:c.isString,rangeLabel:c.isString}},b.prototype.render=function(){var a,b,c,d,e,f,g=this;c=window.setTimeout(function(){return l(g.el).append(g.loading=l(g.template("loading")))},400),(e=this.view)!=null&&e.undelegateEvents(),a={widget:this.id,list:this.bagName,token:this.token},f=this.formOptions;for(b in f)d=f[b],b!=="errorCorrection"&&b!=="pValue"&&(a.filter=d);return l.ajax({url:""+this.service+"list/chart",dataType:"jsonp",data:a,success:function(a){var b;window.clearTimeout(c),(b=g.loading)!=null&&b.remove(),g.validateType(a,g.spec.response);if(a.wasSuccessful)return g.name=a.title,g.view=new y({widget:g,el:g.el,template:g.template,response:a,form:{options:g.formOptions},options:g.widgetOptions})},error:function(a){return g.error(a,"AJAXTransport")}})},b}(d);var m,e=function(a,b){return function(){return a.apply(b,arguments)}},j={}.hasOwnProperty,k=function(a,b){function d(){this.constructor=a}for(var c in b)j.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};m=function(a){function b(a,c,d,g,h,i){this.service=a,this.token=c,this.id=d,this.bagName=g,this.el=h,i==null&&(i={}),this.render=e(this.render,this),this.widgetOptions=f(i,this.widgetOptions),b.__super__.constructor.call(this),this.render()}return k(b,a),b.name="TableWidget",b.prototype.widgetOptions={title:!0,description:!0,matchCb:function(a,b){return typeof console!="undefined"&&console!==null?console.log(a,b):void 0},resultsCb:function(a){return typeof console!="undefined"&&console!==null?console.log(a):void 0},listCb:function(a){return typeof console!="undefined"&&console!==null?console.log(a):void 0}},b.prototype.spec={response:{columnTitle:c.isString,title:c.isString,description:c.isString,pathQuery:c.isString,columns:c.isString,pathConstraint:c.isString,requestedAt:c.isString,list:c.isString,type:c.isString,notAnalysed:c.isInteger,results:c.isArray,wasSuccessful:c.isBoolean,error:c.isNull,statusCode:c.isHTTPSuccess}},b.prototype.render=function(){var a,b,c,d=this;return b=window.setTimeout(function(){return l(d.el).append(d.loading=l(d.template("loading")))},400),(c=this.view)!=null&&c.undelegateEvents(),a={widget:this.id,list:this.bagName,token:this.token},l.ajax({url:""+this.service+"list/table",dataType:"jsonp",data:a,success:function(a){var c;window.clearTimeout(b),(c=d.loading)!=null&&c.remove(),d.validateType(a,d.spec.response);if(a.wasSuccessful)return d.name=a.title,d.view=new w({widget:d,el:d.el,template:d.template,response:a,options:d.widgetOptions})},error:function(a){return d.error(a,"AJAXTransport")}})},b}(d);var n,e=function(a,b){return function(){return a.apply(b,arguments)}},j={}.hasOwnProperty,k=function(a,b){function d(){this.constructor=a}for(var c in b)j.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};n=function(a){function b(a,c,d,g,h,i){this.service=a,this.token=c,this.id=d,this.bagName=g,this.el=h,i==null&&(i={}),this.render=e(this.render,this),this.widgetOptions=f(i,this.widgetOptions),this.formOptions={errorCorrection:"Holm-Bonferroni",pValue:"0.05"},b.__super__.constructor.call(this),this.render()}return k(b,a),b.name="EnrichmentWidget",b.prototype.widgetOptions={title:!0,description:!0,matchCb:function(a,b){return typeof console!="undefined"&&console!==null?console.log(a,b):void 0},resultsCb:function(a){return typeof console!="undefined"&&console!==null?console.log(a):void 0},listCb:function(a){return typeof console!="undefined"&&console!==null?console.log(a):void 0}},b.prototype.errorCorrections=["Holm-Bonferroni","Benjamini Hochberg","Bonferroni","None"],b.prototype.pValues=["0.05","0.10","1.00"],b.prototype.spec={response:{title:c.isString,description:c.isString,pathQuery:c.isJSON,pathConstraint:c.isString,error:c.isNull,list:c.isString,notAnalysed:c.isInteger,requestedAt:c.isString,results:c.isArray,label:c.isString,statusCode:c.isHTTPSuccess,type:c.isString,wasSuccessful:c.isBoolean,filters:c.isString,filterLabel:c.isString,filterSelectedValue:c.isString,externalLink:c.isString,pathQueryForMatches:c.isString}},b.prototype.render=function(){var a,b,c,d,e,f,g=this;c=window.setTimeout(function(){return l(g.el).append(g.loading=l(g.template("loading")))},400),(e=this.view)!=null&&e.undelegateEvents(),a={widget:this.id,list:this.bagName,correction:this.formOptions.errorCorrection,maxp:this.formOptions.pValue,token:this.token},f=this.formOptions;for(b in f)d=f[b],b!=="errorCorrection"&&b!=="pValue"&&(a.filter=d);return l.ajax({url:""+this.service+"list/enrichment",dataType:"jsonp",data:a,success:function(a){var b;window.clearTimeout(c),(b=g.loading)!=null&&b.remove(),g.validateType(a,g.spec.response);if(a.wasSuccessful)return g.name=a.title,g.view=new B({widget:g,el:g.el,template:g.template,response:a,form:{options:g.formOptions,pValues:g.pValues,errorCorrections:g.errorCorrections},options:g.widgetOptions})},error:function(a){return g.error(a,"AJAXTransport")}})},b}(d);var o,p,q,r,s,t,e=function(a,b){return function(){return a.apply(b,arguments)}},j={}.hasOwnProperty,k=function(a,b){function d(){this.constructor=a}for(var c in b)j.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};p=function(a){function b(){return this.toggleSelected=e(this.toggleSelected,this),this.validate=e(this.validate,this),b.__super__.constructor.apply(this,arguments)}return k(b,a),b.name="CoreModel",b.prototype.defaults={selected:!1},b.prototype.initialize=function(a,b){return this.widget=b,this.validate(a)},b.prototype.validate=function(a){return this.widget.validateType(a,this.spec)},b.prototype.toggleSelected=function(){return this.set({selected:!this.get("selected")})},b}(a.Model),o=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return k(b,a),b.name="CoreCollection",b.prototype.model=p,b.prototype.selected=function(){return this.filter(function(a){return a.get("selected")})},b.prototype.toggleSelected=function(){var a,b,c,d,e,f,g,h,i;if(this.models.length-this.selected().length){f=this.models,h=[];for(b=0,d=f.length;b<d;b++)a=f[b],h.push(a.set({selected:!0},{silent:!0}));return h}g=this.models,i=[];for(c=0,e=g.length;c<e;c++)a=g[c],i.push(a.set({selected:!1},{silent:!0}));return i},b}(a.Collection),r=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return k(b,a),b.name="EnrichmentRow",b.prototype.spec={description:c.isString,identifier:c.isString,matches:c.isInteger,"p-value":c.isInteger,selected:c.isBoolean,externalLink:c.isString},b}(p),q=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return k(b,a),b.name="EnrichmentResults",b.prototype.model=r,b}(o),t=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return k(b,a),b.name="TableRow",b.prototype.spec={matches:c.isInteger,identifier:c.isInteger,descriptions:c.isArray,selected:c.isBoolean},b}(p),s=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return k(b,a),b.name="TableResults",b.prototype.model=t,b}(o);var u,e=function(a,b){return function(){return a.apply(b,arguments)}},j={}.hasOwnProperty,k=function(a,b){function d(){this.constructor=a}for(var c in b)j.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};u=function(a){function b(){return this.toggleMatchesAction=e(this.toggleMatchesAction,this),this.selectAction=e(this.selectAction,this),this.render=e(this.render,this),b.__super__.constructor.apply(this,arguments)}return k(b,a),b.name="EnrichmentRowView",b.prototype.tagName="tr",b.prototype.events={"click td.check input":"selectAction","click td.matches a.count":"toggleMatchesAction"},b.prototype.initialize=function(a){var b,c;for(b in a)c=a[b],this[b]=c;return this.model.bind("change",this.render),this.render()},b.prototype.render=function(){return l(this.el).html(this.template("enrichment.row",{row:this.model.toJSON()})),this},b.prototype.selectAction=function(){return this.model.toggleSelected()},b.prototype.toggleMatchesAction=function(){return this.popoverView==null?l(this.el).find("td.matches a.count").after((this.popoverView=new z({matches:this.model.get("matches"),identifiers:[this.model.get("identifier")],description:this.model.get("description"),template:this.template,matchCb:this.callbacks.matchCb,resultsCb:this.callbacks.resultsCb,listCb:this.callbacks.listCb,response:this.response,imService:this.imService})).el):this.popoverView.toggle()},b}(a.View);var v,e=function(a,b){return function(){return a.apply(b,arguments)}},j={}.hasOwnProperty,k=function(a,b){function d(){this.constructor=a}for(var c in b)j.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};v=function(a){function b(){return this.selectAction=e(this.selectAction,this),this.render=e(this.render,this),b.__super__.constructor.apply(this,arguments)}return k(b,a),b.name="TableRowView",b.prototype.tagName="tr",b.prototype.events={"click td.check input":"selectAction"},b.prototype.initialize=function(a){var b,c;for(b in a)c=a[b],this[b]=c;return this.model.bind("change",this.render),this.render()},b.prototype.render=function(){return l(this.el).html(this.template("table.row",{row:this.model.toJSON()})),this},b.prototype.selectAction=function(){return this.model.toggleSelected()},b}(a.View);var w,e=function(a,b){return function(){return a.apply(b,arguments)}},j={}.hasOwnProperty,k=function(a,b){function d(){this.constructor=a}for(var c in b)j.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};w=function(a){function b(){return this.viewAction=e(this.viewAction,this),this.exportAction=e(this.exportAction,this),this.selectAllAction=e(this.selectAllAction,this),this.renderTableBody=e(this.renderTableBody,this),this.renderTable=e(this.renderTable,this),this.renderToolbar=e(this.renderToolbar,this),b.__super__.constructor.apply(this,arguments)}return k(b,a),b.name="TableView",b.prototype.events={"click div.actions a.view":"viewAction","click div.actions a.export":"exportAction","click div.content input.check":"selectAllAction"},b.prototype.initialize=function(a){var b,c;for(b in a)c=a[b],this[b]=c;return this.collection=new s,this.collection.bind("change",this.renderToolbar),this.render()},b.prototype.render=function(){return l(this.el).html(this.template("table",{title:this.options.title?this.response.title:"",description:this.options.description?this.response.description:"",notAnalysed:this.response.notAnalysed})),this.response.results.length>0?(this.renderToolbar(),this.renderTable()):l(this.el).find("div.content").html(l(this.template("noresults"))),this},b.prototype.renderToolbar=function(){return l(this.el).find("div.actions").html(l(this.template("actions",{disabled:this.collection.selected().length===0})))},b.prototype.renderTable=function(){var a,b,c,d,e,f,g=this;l(this.el).find("div.content").html(l(this.template("table.table",{columns:this.response.columns.split(",")}))),c=l(this.el).find("div.content table"),d=function(a){var b;return b=new t(g.response.results[a],g.widget),g.collection.add(b)};for(b=e=0,f=this.response.results.length;0<=f?e<f:e>f;b=0<=f?++e:--e)d(b);return this.renderTableBody(c),a=l(this.el).height()-l(this.el).find("div.header").height()-l(this.el).find("div.content div.head").height(),l(this.el).find("div.content div.wrapper").css("height",""+a+"px"),l(this.el).find("div.content div.head").css("width",l(this.el).find("div.content table").width()+"px"),c.find("thead th").each(function(a,b){return l(g.el).find("div.content div.head div:eq("+a+")").width(l(b).width())}),c.css({"margin-top":"-"+c.find("thead").height()+"px"})},b.prototype.renderTableBody=function(a){var b,c,d,e,f;b=document.createDocumentFragment(),f=this.collection.models;for(d=0,e=f.length;d<e;d++)c=f[d],b.appendChild((new v({model:c,template:this.template,response:this.response})).el);return a.find("tbody").html(b)},b.prototype.selectAllAction=function(){return this.collection.toggleSelected(),this.renderToolbar(),this.renderTableBody(l(this.el).find("div.content table"))},b.prototype.exportAction=function(a){var b,c,d,e,f,g;d=[this.response.columns.replace(/,/g,"	")],g=this.collection.selected();for(e=0,f=g.length;e<f;e++)c=g[e],d.push(c.get("descriptions").join("	")+"	"+c.get("matches"));if(d.length)return b=new i(l(a.target),"<pre>"+d.join("\n")+"<pre>"),window.setTimeout(function(){return b.destroy()},5e3)},b.prototype.viewAction=function(){var a,b,c,d,e,f,g;a=[],c=[],f=this.collection.selected();for(d=0,e=f.length;d<e;d++)b=f[d],a.push(b.get("descriptions")[0]),c.push(b.get("identifier"));if(c.length)return(g=this.popoverView)!=null&&g.remove(),l(this.el).find("div.actions").after((this.popoverView=new x({identifiers:c,description:a.join(", "),template:this.template,matchCb:this.options.matchCb,resultsCb:this.options.resultsCb,listCb:this.options.listCb,pathQuery:this.response.pathQuery,pathConstraint:this.response.pathConstraint,imService:this.widget.imService,type:this.response.type})).el)},b}(a.View);var x,e=function(a,b){return function(){return a.apply(b,arguments)}},j={}.hasOwnProperty,k=function(a,b){function d(){this.constructor=a}for(var c in b)j.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};x=function(a){function b(){return this.close=e(this.close,this),this.listAction=e(this.listAction,this),this.resultsAction=e(this.resultsAction,this),this.matchAction=e(this.matchAction,this),this.renderValues=e(this.renderValues,this),this.render=e(this.render,this),b.__super__.constructor.apply(this,arguments)}return k(b,a),b.name="TablePopoverView",b.prototype.descriptionLimit=50,b.prototype.valuesLimit=5,b.prototype.events={"click a.match":"matchAction","click a.results":"resultsAction","click a.list":"listAction","click a.close":"close"},b.prototype.initialize=function(a){var b,c;for(b in a)c=a[b],this[b]=c;return this.render()},b.prototype.render=function(){var a,b=this;return l(this.el).css({position:"relative"}),l(this.el).html(this.template("popover",{description:this.description,descriptionLimit:this.descriptionLimit,style:"width:300px"})),this.pathQuery=JSON.parse(this.pathQuery),this.pathQuery.where.push({path:this.pathConstraint,op:"ONE OF",values:this.identifiers}),a=[],this.imService.query(this.pathQuery,function(c){return c.rows(function(c){var d,e,f;for(e=0,f=c.length;e<f;e++)d=c[e],a.push(function(a){var b,c,d;for(c=0,d=a.length;c<d;c++){b=a[c];if(b.length>0)return b}}(d));return b.renderValues(a)})}),this},b.prototype.renderValues=function(a){return l(this.el).find("div.values").html(this.template("popover.values",{values:a,type:this.type,valuesLimit:this.valuesLimit}))},b.prototype.matchAction=function(a){return this.matchCb(l(a.target).text(),this.type),a.preventDefault()},b.prototype.resultsAction=function(){return this.resultsCb(this.pathQuery)},b.prototype.listAction=function(){return this.listCb(this.pathQuery)},b.prototype.close=function(){return l(this.el).remove()},b}(a.View);var y,e=function(a,b){return function(){return a.apply(b,arguments)}},j={}.hasOwnProperty,k=function(a,b){function d(){this.constructor=a}for(var c in b)j.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};y=function(a){function b(){return this.formAction=e(this.formAction,this),this.barAction=e(this.barAction,this),b.__super__.constructor.apply(this,arguments)}return k(b,a),b.name="ChartView",b.prototype.events={"change div.form select":"formAction"},b.prototype.initialize=function(a){var b,c;for(b in a)c=a[b],this[b]=c;return this.render()},b.prototype.render=function(){var a,b,c,d,e,f,h,i;l(this.el).html(this.template("chart",{title:this.options.title?this.response.title:"",description:this.options.description?this.response.description:"",notAnalysed:this.response.notAnalysed})),this.response.filterLabel!=null&&l(this.el).find("div.form form").append(this.template("extra",{label:this.response.filterLabel,possible:this.response.filters.split(","),selected:this.response.filterSelectedValue}));if(this.response.results.length>1){b=[],i=this.response.results.slice(1);for(f=0,h=i.length;f<h;f++)e=i[f],b.push({description:e[0],data:[e[1],e[2]]});return a=new g.Column({el:l(this.el).find("div.content div.chart"),data:b,width:460,onclick:this.barAction,isStacked:this.response.chartType==="BarChart",axis:{horizontal:this.response.domainLabel,vertical:this.response.type+" Count"}}),c=new g.Legend({el:l(this.el).find("div.content div.legend"),chart:a,series:[this.response.results[0][1],this.response.results[0][2]]}),c.render(),d=new g.Settings({el:l(this.el).find("div.content div.settings"),chart:a,legend:c,isStacked:this.response.chartType==="BarChart"}),d.render(),a.height=l(this.widget.el).height()-l(this.widget.el).find("div.header").height()-l(this.widget.el).find("div.content div.legend").height()-l(this.widget.el).find("div.content div.settings").height(),a.render()}return l(this.el).find("div.content").html(l(this.template("noresults")))},b.prototype.barAction=function(a,b,c){var d,e,f,g,h;d="",f=this.response.pathQuery,e=this.response.simplePathQuery,d+=a,f=f.replace("%category",a),e=e.replace("%category",a),d+=" "+this.response.seriesLabels.split(",")[b],g=(h=this.response.seriesValues)!=null?h.split(",")[b]:void 0,f=f.replace("%series",g),e=f.replace("%series",g),f=typeof JSON!="undefined"&&JSON!==null?JSON.parse(f):void 0,e=typeof JSON!="undefined"&&JSON!==null?JSON.parse(e):void 0,this.barView!=null&&this.barView.close();if(d)return l(this.el).find("div.content").append((this.barView=new C({description:d,template:this.template,resultsPq:f,resultsCb:this.options.resultsCb,listCb:this.options.listCb,matchCb:this.options.matchCb,quickPq:e,imService:this.widget.imService,type:this.response.type})).el)},b.prototype.formAction=function(a){return this.widget.formOptions[l(a.target).attr("name")]=l(a.target[a.target.selectedIndex]).attr("value"),this.widget.render()},b}(a.View);var z,e=function(a,b){return function(){return a.apply(b,arguments)}},j={}.hasOwnProperty,k=function(a,b){function d(){this.constructor=a}for(var c in b)j.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},A=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};z=function(a){function b(){return this.listAction=e(this.listAction,this),this.resultsAction=e(this.resultsAction,this),this.matchAction=e(this.matchAction,this),this.getPq=e(this.getPq,this),this.toggle=e(this.toggle,this),this.renderValues=e(this.renderValues,this),this.render=e(this.render,this),b.__super__.constructor.apply(this,arguments)}return k(b,a),b.name="EnrichmentPopoverView",b.prototype.descriptionLimit=50,b.prototype.valuesLimit=5,b.prototype.events={"click a.match":"matchAction","click a.results":"resultsAction","click a.list":"listAction","click a.close":"toggle"},b.prototype.initialize=function(a){var b,c;for(b in a)c=a[b],this[b]=c;return this.render()},b.prototype.render=function(){var a,b,c=this;return l(this.el).css({position:"relative"}),l(this.el).html(this.template("popover",{description:this.description,descriptionLimit:this.descriptionLimit,style:this.style||"width:300px;margin-left:-300px"})),a=typeof JSON!="undefined"&&JSON!==null?JSON.parse(this.response.pathQueryForMatches):void 0,a.where.push({path:this.response.pathConstraint,op:"ONE OF",values:this.identifiers}),b=[],this.imService.query(a,function(a){return a.rows(function(a){var d,e,f,g;for(f=0,g=a.length;f<g;f++)d=a[f],e=function(a){var b,c,d,e;e=a.reverse();for(c=0,d=e.length;c<d;c++){b=e[c];if(b.length>0)return b}}(d),A.call(b,e)<0&&b.push(e);return c.renderValues(b)})}),this},b.prototype.renderValues=function(a){return l(this.el).find("div.values").html(this.template("popover.values",{values:a,type:this.response.type,valuesLimit:this.valuesLimit}))},b.prototype.toggle=function(){return l(this.el).toggle()},b.prototype.getPq=function(){var a;return a=this.response.pathQuery,this.pq=JSON.parse(a),this.pq.where.push({path:this.response.pathConstraint,op:"ONE OF",values:this.identifiers})},b.prototype.matchAction=function(a){return this.matchCb(l(a.target).text(),this.response.type),a.preventDefault()},b.prototype.resultsAction=function(){return this.pq==null&&this.getPq(),this.resultsCb(this.pq)},b.prototype.listAction=function(){return this.pq==null&&this.getPq(),this.listCb(this.pq)},b}(a.View);var B,e=function(a,b){return function(){return a.apply(b,arguments)}},j={}.hasOwnProperty,k=function(a,b){function d(){this.constructor=a}for(var c in b)j.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};B=function(a){function b(){return this.viewAction=e(this.viewAction,this),this.exportAction=e(this.exportAction,this),this.selectAllAction=e(this.selectAllAction,this),this.formAction=e(this.formAction,this),this.renderTableBody=e(this.renderTableBody,this),this.renderTable=e(this.renderTable,this),this.renderToolbar=e(this.renderToolbar,this),b.__super__.constructor.apply(this,arguments)}return k(b,a),b.name="EnrichmentView",b.prototype.events={"click div.actions a.view":"viewAction","click div.actions a.export":"exportAction","change div.form select":"formAction","click div.content input.check":"selectAllAction"},b.prototype.initialize=function(a){var b,c;for(b in a)c=a[b],this[b]=c;return this.collection=new q,this.collection.bind("change",this.renderToolbar),this.render()},b.prototype.render=function(){return l(this.el).html(this.template("enrichment",{title:this.options.title?this.response.title:"",description:this.options.description?this.response.description:"",notAnalysed:this.response.notAnalysed})),l(this.el).find("div.form").html(this.template("enrichment.form",{options:this.form.options,pValues:this.form.pValues,errorCorrections:this.form.errorCorrections})),this.response.filterLabel!=null&&l(this.el).find("div.form form").append(this.template("extra",{label:this.response.filterLabel,possible:this.response.filters.split(","),selected:this.response.filterSelectedValue})),this.response.results.length>0?(this.renderToolbar(),this.renderTable()):l(this.el).find("div.content").html(l(this.template("noresults"))),this},b.prototype.renderToolbar=function(){return l(this.el).find("div.actions").html(l(this.template("actions",{disabled:this.collection.selected().length===0})))},b.prototype.renderTable=function(){var a,b,c,d,e,f,g=this;l(this.el).find("div.content").html(l(this.template("enrichment.table",{label:this.response.label}))),c=l(this.el).find("div.content table"),d=function(a){var b,c;return b=g.response.results[a],g.response.externalLink&&(b.externalLink=g.response.externalLink+b.identifier),c=new r(b,g.widget),g.collection.add(c)};for(b=e=0,f=this.response.results.length;0<=f?e<f:e>f;b=0<=f?++e:--e)d(b);return this.renderTableBody(c),a=l(this.el).height()-l(this.el).find("div.header").height()-l(this.el).find("div.content div.head").height(),l(this.el).find("div.content div.wrapper").css("height",""+a+"px"),l(this.el).find("div.content div.head").css("width",l(this.el).find("div.content table").width()+"px"),c.find("thead th").each(function(a,b){return l(g.el).find("div.content div.head div:eq("+a+")").width(l(b).width())}),c.css({"margin-top":"-"+c.find("thead").height()+"px"})},b.prototype.renderTableBody=function(a){var b,c,d,e,f;b=document.createDocumentFragment(),f=this.collection.models;for(d=0,e=f.length;d<e;d++)c=f[d],b.appendChild((new u({model:c,template:this.template,type:this.response.type,callbacks:{matchCb:this.options.matchCb,resultsCb:this.options.resultsCb,listCb:this.options.listCb},response:this.response,imService:this.widget.imService})).el);return a.find("tbody").html(b)},b.prototype.formAction=function(a){return this.widget.formOptions[l(a.target).attr("name")]=l(a.target[a.target.selectedIndex]).attr("value"),this.widget.render()},b.prototype.selectAllAction=function(){return this.collection.toggleSelected(),this.renderToolbar(),this.renderTableBody(l(this.el).find("div.content table"))},b.prototype.exportAction=function(a){var b,c,d,e,f,g,h=this;d=[],g=this.collection.selected();for(e=0,f=g.length;e<f;e++)b=g[e],d.push(b.get("identifier"));return c=typeof JSON!="undefined"&&JSON!==null?JSON.parse(this.response.pathQueryForMatches):void 0,c.where.push({path:this.response.pathConstraint,op:"ONE OF",values:d}),this.widget.imService.query(c,function(b){return b.rows(function(b){var c,d,e,f,g,j,k,m,n,o;c={};for(j=0,m=b.length;j<m;j++)f=b[j],c[f[0]]==null&&(c[f[0]]=[]),c[f[0]].push(f[1]);g=[],o=h.collection.selected();for(k=0,n=o.length;k<n;k++)e=o[k],g.push([e.get("description"),e.get("p-value")].join("	")+"	"+c[e.get("identifier")].join(","));if(g.length)return d=new i(l(a.target),"<pre>"+g.join("\n")+"<pre>"),window.setTimeout(function(){return d.destroy()},5e3)})})},b.prototype.viewAction=function(){var a,b,c,d,e,f,g;a=[],c=[],f=this.collection.selected();for(d=0,e=f.length;d<e;d++)b=f[d],a.push(b.get("description")),c.push(b.get("identifier"));if(c.length)return(g=this.popoverView)!=null&&g.remove(),l(this.el).find("div.actions").after((this.popoverView=new z({identifiers:c,description:a.join(", "),template:this.template,style:"width:300px",matchCb:this.options.matchCb,resultsCb:this.options.resultsCb,listCb:this.options.listCb,response:this.response,imService:this.widget.imService})).el)},b}(a.View);var C,e=function(a,b){return function(){return a.apply(b,arguments)}},j={}.hasOwnProperty,k=function(a,b){function d(){this.constructor=a}for(var c in b)j.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};return C=function(a){function b(){return this.close=e(this.close,this),this.listAction=e(this.listAction,this),this.resultsAction=e(this.resultsAction,this),this.matchAction=e(this.matchAction,this),this.renderValues=e(this.renderValues,this),this.render=e(this.render,this),b.__super__.constructor.apply(this,arguments)}return k(b,a),b.name="ChartPopoverView",b.prototype.descriptionLimit=50,b.prototype.valuesLimit=5,b.prototype.events={"click a.match":"matchAction","click a.results":"resultsAction","click a.list":"listAction","click a.close":"close"},b.prototype.initialize=function(a){var b,c;for(b in a)c=a[b],this[b]=c;return this.render()},b.prototype.render=function(){var a,b=this;return l(this.el).html(this.template("popover",{description:this.description,descriptionLimit:this.descriptionLimit,style:"width:300px"})),a=[],this.imService.query(this.quickPq,function(c){return c.rows(function(c){var d,e,f;for(e=0,f=c.length;e<f;e++)d=c[e],a.push(function(a){var b,c,d;for(c=0,d=a.length;c<d;c++){b=a[c];if(b.length>0)return b}}(d));return b.renderValues(a)})}),this},b.prototype.renderValues=function(a){return l(this.el).find("div.values").html(this.template("popover.values",{values:a,type:this.type,valuesLimit:this.valuesLimit}))},b.prototype.matchAction=function(a){return this.matchCb(l(a.target).text(),this.type),a.preventDefault()},b.prototype.resultsAction=function(){return this.resultsCb(this.resultsPq)},b.prototype.listAction=function(){return this.listCb(this.resultsPq)},b.prototype.close=function(){return l(this.el).remove()},b}(a.View),{InterMineWidget:d,ChartWidget:h,TableWidget:m,EnrichmentWidget:n,CoreModel:p,EnrichmentRowView:u,TableRowView:v,TableView:w,TablePopoverView:x,ChartView:y,EnrichmentPopoverView:z,EnrichmentView:B,ChartPopoverView:C}};var l,m,j=function(a,b){return function(){return a.apply(b,arguments)}},d={}.hasOwnProperty,e=function(a,b){function e(){this.constructor=a}for(var c in b)d.call(b,c)&&(a[c]=b[c]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a},n=[].slice,o=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};l=window.jQuery||window.Zepto,m=function(){function b(b,c){var d=this;this.service=b,this.token=c!=null?c:"",this.all=j(this.all,this),this.table=j(this.table,this),this.enrichment=j(this.enrichment,this),this.chart=j(this.chart,this),intermine.load(this.resources,function(){return l=window.jQuery,e(a,k(window.Backbone)),d.wait=!1})}return b.name="Widgets",b.prototype.VERSION="d3",b.prototype.wait=!0,b.prototype.resources=[{name:"JSON",path:"http://cdnjs.cloudflare.com/ajax/libs/json3/3.2.2/json3.min.js",type:"js"},{name:"jQuery",path:"http://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js",type:"js",wait:!0},{name:"_",path:"http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js",type:"js",wait:!0},{name:"Backbone",path:"http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js",type:"js",wait:!0},{name:"d3",path:"http://d3js.org/d3.v2.js",type:"js"},{path:"https://raw.github.com/alexkalderimis/imjs/master/src/model.js",type:"js"},{path:"https://raw.github.com/alexkalderimis/imjs/master/src/query.js",type:"js"},{path:"https://raw.github.com/alexkalderimis/imjs/master/src/service.js",type:"js"},{path:"http://canvg.googlecode.com/svn/trunk/rgbcolor.js",type:"js"},{path:"http://canvg.googlecode.com/svn/trunk/canvg.js",type:"js"}],b.prototype.chart=function(){var b,c=this;return b=1<=arguments.length?n.call(arguments,0):[],this.wait?window.setTimeout(function(){return c.chart.apply(c,b)},0):function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b),f=typeof e;return f=="object"||f=="function"?e||d:d}(a.ChartWidget,[this.service,this.token].concat(n.call(b)),function(){})},b.prototype.enrichment=function(){var b,c=this;return b=1<=arguments.length?n.call(arguments,0):[],this.wait?window.setTimeout(function(){return c.enrichment.apply(c,b)},0):function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b),f=typeof e;return f=="object"||f=="function"?e||d:d}(a.EnrichmentWidget,[this.service,this.token].concat(n.call(b)),function(){})},b.prototype.table=function(){var b,c=this;return b=1<=arguments.length?n.call(arguments,0):[],this.wait?window.setTimeout(function(){return c.table.apply(c,b)},0):function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b),f=typeof e;return f=="object"||f=="function"?e||d:d}(a.TableWidget,[this.service,this.token].concat(n.call(b)),function(){})},b.prototype.all=function(a,b,c,d){var e=this;return a==null&&(a="Gene"),this.wait?window.setTimeout(function(){return e.all(a,b,c,d)},0):l.ajax({url:""+this.service+"widgets",dataType:"jsonp",success:function(f){var g,h,i,j,k,m;if(f.widgets){k=f.widgets,m=[];for(i=0,j=k.length;i<j;i++){g=k[i];if(!(o.call(g.targets,a)>=0))continue;h=g.name.replace(/[^-a-zA-Z0-9,&\s]+/ig,"").replace(/-/gi,"_").replace(/\s/gi,"-").toLowerCase(),l(c).append(l("<div/>",{id:h,"class":"widget span6"}));switch(g.widgetType){case"chart":m.push(e.chart(g.name,b,""+c+" #"+h,d));break;case"enrichment":m.push(e.enrichment(g.name,b,""+c+" #"+h,d));break;case"table":m.push(e.table(g.name,b,""+c+" #"+h,d));break;default:m.push(void 0)}}return m}},error:function(a,b,d){return l(c).html(l("<div/>",{"class":"alert alert-error",html:""+a.statusText+" for <a href='"+e.service+"widgets'>"+e.service+"widgets</a>"}))}})},b}();if(!window.intermine)throw"You need to include the InterMine API Loader first!";window.intermine.widgets=m}).call(this)